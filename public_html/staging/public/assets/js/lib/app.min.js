"use strict"; const sidebar = $(".sidebar"), dashboardMain = $(".dashboard-main"), sidebartoggle = $(".sidebar-toggle"), storageKey = "sidebar_state", state = localStorage.getItem(storageKey); "minimized" === state && (sidebar.addClass("active"), dashboardMain.addClass("active"), sidebartoggle.addClass("active")), document.querySelectorAll(".sidebar-menu .dropdown").forEach((function (e) { e.addEventListener("click", (function () { var e = this; e.parentNode.querySelectorAll(".dropdown").forEach((function (t) { t !== e && (t.querySelector(".sidebar-submenu").style.display = "none", t.classList.remove("dropdown-open"), t.classList.remove("open")) })); var t = e.querySelector(".sidebar-submenu"); t.style.display = "block" === t.style.display ? "none" : "block", e.classList.toggle("dropdown-open") })) })); const sidebarToggle = document.querySelector(".sidebar-toggle"); sidebarToggle && sidebarToggle.addEventListener("click", (function () { this.classList.toggle("active"), document.querySelector(".sidebar").classList.toggle("active"), document.querySelector(".dashboard-main").classList.toggle("active") })); const sidebarMobileToggle = document.querySelector(".sidebar-mobile-toggle"); sidebarMobileToggle && sidebarMobileToggle.addEventListener("click", (function () { document.querySelector(".sidebar").classList.add("sidebar-open"), document.body.classList.add("overlay-active") })); const sidebarColseBtn = document.querySelector(".sidebar-close-btn"); sidebarColseBtn && sidebarColseBtn.addEventListener("click", (function () { document.querySelector(".sidebar").classList.remove("sidebar-open"), document.body.classList.remove("overlay-active") })), document.addEventListener("DOMContentLoaded", (function () { var e = window.location.href; document.querySelectorAll("ul#sidebar-menu a").forEach((function (t) { if (t.href === e) { t.classList.add("active-page"); var o = t.parentElement; for (o.classList.add("active-page"); o && "BODY" !== o.tagName;)"LI" === o.tagName && (o.classList.add("show"), o.classList.add("open")), o = o.parentElement } })) })), "dark" === localStorage.getItem("color-theme") || !("color-theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches ? document.documentElement.classList.add("dark") : document.documentElement.classList.remove("dark"); var themeToggleDarkIcon = document.getElementById("theme-toggle-dark-icon"), themeToggleLightIcon = document.getElementById("theme-toggle-light-icon"); (themeToggleDarkIcon || themeToggleLightIcon) && ("dark" === localStorage.getItem("color-theme") || !("color-theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches ? themeToggleLightIcon.classList.remove("hidden") : themeToggleDarkIcon.classList.remove("hidden")); var themeToggleBtn = document.getElementById("theme-toggle"); (themeToggleDarkIcon || themeToggleLightIcon || themeToggleBtn) && themeToggleBtn.addEventListener("click", (function () { themeToggleDarkIcon.classList.toggle("hidden"), themeToggleLightIcon.classList.toggle("hidden"), localStorage.getItem("color-theme") ? "light" === localStorage.getItem("color-theme") ? (document.documentElement.classList.add("dark"), localStorage.setItem("color-theme", "dark")) : (document.documentElement.classList.remove("dark"), localStorage.setItem("color-theme", "light")) : document.documentElement.classList.contains("dark") ? (document.documentElement.classList.remove("dark"), localStorage.setItem("color-theme", "light")) : (document.documentElement.classList.add("dark"), localStorage.setItem("color-theme", "dark")) })), $(".remove-button").on("click", (function () { $(this).closest(".alert").addClass("hidden") })), $("button[data-tabs-target]").on("click", (function () { setTimeout((() => { $.fn.dataTable.tables({ visible: !0, api: !0 }).columns.adjust() }), 1) })), $(".sidebar-toggle").on("click", (function () { sidebar.hasClass("active") ? localStorage.setItem(storageKey, "minimized") : localStorage.setItem(storageKey, "expanded") }));
$(function () {
    window.Parsley.addValidator('fileextension', {
        requirementType: 'string',
        validateString: function (value, requirement, parsleyInstance) {
            var fileInput = parsleyInstance.$element[0];
            if (fileInput.files.length === 0) return true; // Tidak ada file, biar required yang tangani

            var allowedExtensions = requirement.split(',');
            var fileName = fileInput.files[0].name.toLowerCase();
            var extension = fileName.split('.').pop();

            return allowedExtensions.includes(extension);
        },
        messages: {
            en: 'Invalid file type. Allowed types: %s.',
            id: 'Tipe file tidak diizinkan. Hanya boleh: %s.'
        }
    });
    window.Parsley.addValidator('phoneid', {
        requirementType: 'string',
        validateString: function (value) {
            return /^(08|02)[0-9]{7,12}$/.test(value);
        },
        messages: {
            id: 'Nomor HP tidak valid. Gunakan format 08xxxxxxxxxx atau 02xxxxxxxxxx.'
        }
    });
    window.Parsley.addValidator('maxfilesize', {
        validateString: function (_value, maxSize, parsleyInstance) {
            if (!window.FormData) {
                alert("Browser tidak mendukung FormData API.");
                return true;
            }

            var files = parsleyInstance.$element[0].files;
            if (files.length === 0) {
                return true;
            }

            for (var i = 0; i < files.length; i++) {
                if (files[i].size > maxSize) {
                    return false;
                }
            }
            return true;
        },
        requirementType: 'integer',
        messages: {
            id: 'Ukuran file terlalu besar (maksimal %{requirement} byte).'
        }
    });
    $('input[type="date"]').each(function () {
        const inst = flatpickr(this, { dateFormat: 'Y-m-d' });
        $(this).siblings('.clearIcon').on('click', () => inst.clear());
    });
    function showCardLoader() {
        // kalau sudah ada loader, jangan buat lagi
        if ($('#card-loader').length) return;

        const loaderHtml = `
        <div id="card-loader" class="inset-0 flex items-center justify-center z-50">
            <div class="flex flex-col items-center">
                <svg class="animate-spin h-6 w-6 text-primary-600 mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                </svg>
                <span class="text-sm text-gray-700 dark:text-gray-300">Memuat data...</span>
            </div>
        </div>
    `;

        // tambahkan loader ke dalam card-body
        $('.card-body').append(loaderHtml);
    }

    function hideCardLoader() {
        $('#card-loader').fadeOut(300, function () {
            $(this).remove();
        });
    }

    $(document).ready(function () {
        const $content = $('#card-title-tab-content');
        if ($content.length) {

            $content.hide();
            showCardLoader();

            let totalTables = $('table.dataTable').length;
            let loadedTables = 0;
            $('table.dataTable').on('init.dt', function () {
                    hideCardLoader();
                    $content.fadeIn(300);
            });

        }
    });
});